<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lung Cancer Prediction - Precision Medicine</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --card-shadow: 0 25px 50px rgba(0, 0, 0, 0.08);
            --card-shadow-hover: 0 35px 70px rgba(0, 0, 0, 0.15);
            --text-primary: #2c3e50;
            --text-secondary: #64748b;
            --white-transparent: rgba(255, 255, 255, 0.95);
            --border-radius: 25px;
            --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            
            /* Enhanced color palette */
            --primary-blue: #3b82f6;
            --secondary-blue: #1e40af;
            --success-green: #10b981;
            --warning-orange: #f59e0b;
            --danger-red: #ef4444;
            --purple-gradient: linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%);
            --blue-gradient: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            --green-gradient: linear-gradient(135deg, #10b981 0%, #059669 100%);
            --red-gradient: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            --orange-gradient: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            
            /* Neutral Colors */
            --white: #ffffff;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            
            /* Spacing */
            --space-xs: 0.5rem;
            --space-sm: 0.75rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
            --space-2xl: 3rem;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* Enhanced Background with animated gradient */
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, 
                #fef3c7 0%,     /* Light amber */
                #fed7aa 15%,    /* Light orange */
                #fbb6ce 30%,    /* Light pink */
                #c7d2fe 45%,    /* Light indigo */
                #a5f3fc 60%,    /* Light cyan */
                #bbf7d0 75%,    /* Light emerald */
                #fde68a 90%,    /* Light yellow */
                #fef3c7 100%);  /* Back to light amber */
            background-size: 400% 400%;
            animation: gradientShift 20s ease infinite;
            position: relative;
            overflow-x: hidden;
            color: var(--text-primary);
            line-height: 1.6;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            25% { background-position: 100% 25%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 75%; }
            100% { background-position: 0% 50%; }
        }

        /* Add subtle floating particles */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.3) 1px, transparent 1px),
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.4) 1px, transparent 1px),
                radial-gradient(circle at 40% 40%, rgba(255, 255, 255, 0.2) 1px, transparent 1px),
                radial-gradient(circle at 60% 90%, rgba(255, 255, 255, 0.3) 1px, transparent 1px);
            background-size: 100px 100px, 120px 120px, 80px 80px, 150px 150px;
            animation: floatParticles 25s linear infinite;
            pointer-events: none;
        }

        @keyframes floatParticles {
            0% { transform: translateY(0px) rotate(0deg); }
            100% { transform: translateY(-100px) rotate(360deg); }
        }
        
        /* Navigation Bar */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            padding: 1rem 2rem;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 3rem;
        }

        .nav-brand {
            font-family: 'Poppins', sans-serif;
            font-size: 1.6rem;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-link {
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            font-family: 'Inter', sans-serif;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            transition: all 0.3s ease;
            position: relative;
            letter-spacing: 0.2px;
        }

        .nav-link:hover {
            color: #667eea;
            background: rgba(102, 126, 234, 0.08);
            transform: translateY(-1px);
        }

        .nav-link.active {
            color: white;
            background: var(--primary-gradient);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .nav-profile {
            display: flex;
            align-items: center;
            gap: 1rem;
            position: relative;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .back-btn {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            padding: var(--space-sm) var(--space-lg);
            background: var(--primary-gradient);
            color: var(--white);
            text-decoration: none;
            border-radius: 12px;
            font-weight: 500;
            transition: var(--transition);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        /* Data Records Button */
        .data-records-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: var(--primary-gradient);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .data-records-btn:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }

        .data-records-btn:active {
            transform: translateY(-2px) scale(1.05);
        }

        /* Clear Button */
        .clear-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--danger-red);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }

        .clear-btn:hover {
            background: #dc2626;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 2000;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            max-width: 95%;
            max-height: 90%;
            margin: 2% auto;
            padding: 0;
            position: relative;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            padding: 25px 30px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--primary-gradient);
            color: white;
        }

        .modal-title {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: white;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .modal-body {
            padding: 30px;
            max-height: 70vh;
            overflow-y: auto;
        }

        /* Table Styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .data-table th,
        .data-table td {
            padding: 12px 8px;
            text-align: center;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            font-size: 0.85rem;
        }

        .data-table th {
            background: var(--primary-gradient);
            color: white;
            font-weight: 600;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .data-table tr:hover {
            background: rgba(102, 126, 234, 0.05);
        }

        .data-table tr:nth-child(even) {
            background: rgba(0, 0, 0, 0.02);
        }

        .copy-btn {
            background: var(--success-green);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            margin: 0 auto;
        }

        .copy-btn:hover {
            background: #059669;
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .copy-btn:active {
            transform: translateY(0);
        }

        /* Success message */
        .success-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--success-green);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            font-weight: 500;
            z-index: 3000;
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .success-message.show {
            opacity: 1;
        }

        /* Main Content Section */
        .main-section {
            position: relative;
            z-index: 10;
            margin: 120px 50px 50px;
            padding: 60px 40px;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(0, 0, 0, 0.08);
            border-radius: var(--border-radius);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.08);
        }

        /* Page Header */
        .page-header {
            text-align: center;
            margin-bottom: 50px;
            padding-top: 10px;
        }

        .page-header h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 2.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #1e293b 0%, #475569 50%, #64748b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
        }

        .page-header p {
            font-size: 1.1rem;
            color: var(--text-secondary);
            font-weight: 400;
        }
        
        /* Container with single column layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: var(--space-2xl);
        }
        
        /* Enhanced Card Styling with premium look */
        .card {
            background: linear-gradient(145deg, 
                rgba(255, 255, 255, 0.95) 0%, 
                rgba(255, 255, 255, 0.85) 50%, 
                rgba(255, 255, 255, 0.9) 100%);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 25px;
            padding: 45px 35px;
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.08),
                0 10px 20px rgba(0, 0, 0, 0.04),
                inset 0 2px 0 rgba(255, 255, 255, 0.7);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            width: 100%;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--primary-gradient);
            border-radius: 25px 25px 0 0;
        }
        
        .card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 
                0 35px 70px rgba(0, 0, 0, 0.15),
                0 20px 40px rgba(0, 0, 0, 0.08),
                inset 0 2px 0 rgba(255, 255, 255, 0.9);
            border-color: rgba(255, 255, 255, 0.6);
        }

        /* Specialized Card Styling with unique gradients */
        .card.patient-info::before {
            background: var(--blue-gradient);
        }

        .card.health-score::before {
            background: var(--green-gradient);
        }

        .card.ai-suggestions::before {
            background: var(--purple-gradient);
        }
        
        .card-title {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 30px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 15px;
            line-height: 1.3;
        }
        
        .card-icon {
            font-size: 1.5rem;
            width: 45px;
            height: 45px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(102, 126, 234, 0.08) 100%);
            border: 1px solid rgba(102, 126, 234, 0.25);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.1);
        }

        /* Enhanced Form Elements */
        .input-form {
            display: grid;
            gap: 25px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .form-label {
            font-weight: 500;
            color: var(--text-primary);
            font-size: 0.95rem;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Educational Tooltips */
        .tooltip-icon {
            width: 16px;
            height: 16px;
            background: var(--primary-blue);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            cursor: help;
            position: relative;
        }

        .tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gray-800);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            line-height: 1.4;
            max-width: 280px;
            width: max-content;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            margin-bottom: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: var(--gray-800);
        }

        .tooltip-icon:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }
        
        .form-input, .form-select {
            padding: 14px 18px;
            border: 2px solid rgba(102, 126, 234, 0.15);
            border-radius: 15px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
        }
        
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            background: rgba(255, 255, 255, 0.95);
            transform: translateY(-2px);
        }
        
        .form-input:hover, .form-select:hover {
            border-color: rgba(102, 126, 234, 0.3);
            background: rgba(255, 255, 255, 0.95);
        }

        /* Gene Mutations Section */
        .mutations-section {
            background: rgba(239, 246, 255, 0.5);
            border-radius: 15px;
            padding: 25px;
            margin-top: 25px;
        }
        
        .mutations-title {
            font-family: 'Poppins', sans-serif;
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .mutations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 18px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .checkbox-group:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateY(-1px);
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin: 0;
            cursor: pointer;
        }
        
        .checkbox-group label {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-primary);
            cursor: pointer;
            margin: 0;
        }

        /* Premium Button Styling */
        .predict-btn, .explore-btn {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 18px 36px;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 30px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
            font-family: 'Poppins', sans-serif;
            letter-spacing: 0.5px;
        }

        .explore-btn {
            background: var(--purple-gradient);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.3);
            margin-top: 0;
        }

        .explore-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(139, 92, 246, 0.4);
        }

        .predict-btn::before, .explore-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }
        
        .predict-btn:hover::before, .explore-btn:hover::before {
            left: 100%;
        }
        
        .predict-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }
        
        .predict-btn:disabled, .explore-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .loading-spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Enhanced Health Score with animated circle */
        .health-score {
            text-align: center;
        }
        
        .score-circle {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            margin: 0 auto 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--white);
            background: conic-gradient(var(--success-green) 0deg, var(--success-green) 252deg, rgba(16, 185, 129, 0.2) 252deg);
            box-shadow: 0 20px 40px rgba(16, 185, 129, 0.3);
            position: relative;
            transition: all 0.3s ease;
        }

        .score-circle::after {
            content: '';
            position: absolute;
            inset: 10px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
        }

        .score-circle span {
            position: relative;
            z-index: 1;
        }

        .score-circle:hover {
            transform: scale(1.05);
            box-shadow: 0 25px 50px rgba(16, 185, 129, 0.4);
        }
        
        .score-circle.warning {
            background: conic-gradient(var(--warning-orange) 0deg, var(--warning-orange) 180deg, rgba(245, 158, 11, 0.2) 180deg);
            box-shadow: 0 20px 40px rgba(245, 158, 11, 0.3);
        }

        .score-circle.warning:hover {
            box-shadow: 0 25px 50px rgba(245, 158, 11, 0.4);
        }
        
        .score-circle.danger {
            background: conic-gradient(var(--danger-red) 0deg, var(--danger-red) 108deg, rgba(239, 68, 68, 0.2) 108deg);
            box-shadow: 0 20px 40px rgba(239, 68, 68, 0.3);
        }

        .score-circle.danger:hover {
            box-shadow: 0 25px 50px rgba(239, 68, 68, 0.4);
        }
        
        .score-text {
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 1.1rem;
        }
        
        /* Enhanced Prediction Results */
        .prediction-results {
            min-height: 250px;
        }

        .results-content {
            padding: 25px;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(239, 68, 68, 0.1);
            min-height: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .no-results {
            text-align: center;
            color: var(--text-secondary);
            font-style: italic;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 15px;
            font-size: 1.1rem;
        }

        .no-results-icon {
            font-size: 2.5rem;
            opacity: 0.5;
        }
        
        .results-display {
            display: none;
            width: 100%;
        }
        
        .result-summary {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(239, 68, 68, 0.1);
        }
        
        .result-summary h3 {
            color: var(--text-primary);
            font-size: 1.2rem;
            font-weight: 600;
        }

        .risk-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .risk-badge.risk-high {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-red);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .risk-badge.risk-low {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-green);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        
        .result-stats {
            display: grid;
            gap: 15px;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
            border-radius: 10px;
            font-size: 0.95rem;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        /* Personalized Recommendations */
        .recommendations {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 2px solid rgba(102, 126, 234, 0.1);
        }

        .recommendations h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .recommendation-list {
            display: grid;
            gap: 12px;
        }

        .recommendation-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            border-left: 4px solid var(--primary-blue);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .recommendation-icon {
            font-size: 1.1rem;
            margin-top: 2px;
        }

        /* AI Suggestions Styles */
        .ai-suggestions-content {
            text-align: center;
        }

        .ai-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
            padding: 40px 20px;
            background: rgba(139, 92, 246, 0.05);
            border-radius: 15px;
            border: 2px dashed rgba(139, 92, 246, 0.2);
            min-height: 200px;
        }

        .ai-placeholder-icon {
            font-size: 3rem;
            color: rgba(139, 92, 246, 0.6);
        }

        .ai-placeholder-text {
            color: var(--text-secondary);
            font-size: 1.1rem;
            text-align: center;
            line-height: 1.6;
        }

        .ai-results {
            display: none;
            padding: 30px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            border: 1px solid rgba(139, 92, 246, 0.2);
        }

        .condition-description {
            background: rgba(139, 92, 246, 0.1);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            border-left: 4px solid var(--purple-gradient);
        }

        .condition-description h4 {
            color: var(--text-primary);
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .condition-description p {
            color: var(--text-primary);
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .ai-suggestions-list {
            display: grid;
            gap: 15px;
        }

        .ai-suggestion-item {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            border-left: 4px solid #8b5cf6;
            transition: all 0.3s ease;
        }

        .ai-suggestion-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 20px rgba(139, 92, 246, 0.1);
        }

        .ai-suggestion-icon {
            font-size: 1.3rem;
            margin-top: 2px;
            color: #8b5cf6;
        }

        .ai-suggestion-content h5 {
            color: var(--text-primary);
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .ai-suggestion-content p {
            color: var(--text-secondary);
            line-height: 1.5;
            font-size: 0.9rem;
        }

        /* Connection Status */
        .connection-status {
            position: fixed;
            bottom: 100px;
            right: 30px;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            z-index: 1000;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .connection-status.connected {
            background: var(--success-green);
            color: white;
        }

        .connection-status.disconnected {
            background: var(--danger-red);
            color: white;
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-section {
                margin: 120px 25px 25px;
                padding: 50px 25px;
            }

            .data-table {
                font-size: 0.8rem;
            }

            .data-table th,
            .data-table td {
                padding: 8px 6px;
            }
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .mutations-grid {
                grid-template-columns: 1fr;
            }
            
            .navbar {
                padding: 1rem;
            }

            .nav-left {
                gap: 1.5rem;
            }

            .nav-links {
                display: none;
            }

            .user-info {
                display: none;
            }

            .page-header h1 {
                font-size: 2.2rem;
            }
            
            .main-section {
                margin: 100px 15px 20px;
                padding: 40px 20px;
            }

            .modal-content {
                margin: 5% auto;
                max-width: 98%;
            }

            .data-table {
                font-size: 0.75rem;
            }

            .data-table th,
            .data-table td {
                padding: 6px 4px;
            }
        }

        @media (max-width: 480px) {
            .page-header h1 {
                font-size: 2rem;
            }
            
            .main-section {
                margin: 90px 10px 15px;
                padding: 30px 15px;
            }
            
            .card {
                padding: 35px 25px;
            }

            .score-circle {
                width: 120px;
                height: 120px;
                font-size: 1.8rem;
            }

            .data-records-btn {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
                bottom: 20px;
                right: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Connection Status -->
    <div class="connection-status" id="connectionStatus" style="display: none;">
        üîó Connecting...
    </div>

    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-left">
            <div class="nav-brand">
                üî¨ PRED.AI
            </div>
            <div class="nav-links">
                <a href="#" class="nav-link active">Lung Cancer</a>
            </div>
        </div>
        <div class="nav-profile">
            <a href="/dashboard" class="back-btn">
                <span>‚Üê</span>
                <span>Back to Dashboard</span>
            </a>
        </div>
    </nav>
    
    <!-- Main Content Section -->
    <div class="main-section">
        <!-- Page Header -->
        <div class="page-header">
            <h1>ü´Å Lung Cancer Prediction</h1>
            <p>Advanced AI-powered lung cancer risk assessment with genetic analysis and personalized recommendations</p>
        </div>
        
        <div class="container">
            <!-- Patient Information Card -->
            <div class="card patient-info">
                <h2 class="card-title">
                    <span class="card-icon">üìù</span>
                    Patient Information
                </h2>
                <form class="input-form" id="predictionForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">
                                Age (years)
                                <div class="tooltip-icon">
                                    i
                                    <div class="tooltip">Age is a significant risk factor for lung cancer. Risk increases with age, with most cases occurring after age 65.</div>
                                </div>
                            </label>
                            <input type="number" class="form-input" id="age" name="age" 
                                   min="20" max="90" value="65" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                Gender
                                <div class="tooltip-icon">
                                    i
                                    <div class="tooltip">Men historically have higher lung cancer rates, though rates in women have increased due to increased smoking rates.</div>
                                </div>
                            </label>
                            <select class="form-select" id="sex" name="sex" required>
                                <option value="0">Female</option>
                                <option value="1" selected>Male</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Gene Mutations Section -->
                    <div class="mutations-section">
                        <h3 class="mutations-title">
                            <span>üß¨</span>
                            Gene Mutations
                        </h3>
                        <div class="mutations-grid">
                            <div class="checkbox-group">
                                <input type="checkbox" id="egfr" name="egfr">
                                <label for="egfr">EGFR Mutation</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="kras" name="kras">
                                <label for="kras">KRAS Mutation</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="alk" name="alk">
                                <label for="alk">ALK Mutation</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="tp53" name="tp53">
                                <label for="tp53">TP53 Mutation</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="stk11" name="stk11">
                                <label for="stk11">STK11 Mutation</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="keap1" name="keap1">
                                <label for="keap1">KEAP1 Mutation</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="braf" name="braf">
                                <label for="braf">BRAF Mutation</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="ros1" name="ros1">
                                <label for="ros1">ROS1 Mutation</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="met" name="met">
                                <label for="met">MET Mutation</label>
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="predict-btn" id="predictBtn">
                        <span class="loading-spinner" id="loadingSpinner"></span>
                        <span id="btnText">üîç Predict Lung Cancer Risk</span>
                    </button>
                </form>
            </div>
            
            <!-- Health Score Card -->
            <div class="card health-score">
                <button class="clear-btn" id="clearBtn" onclick="clearResults()">
                    üóëÔ∏è Clear
                </button>
                <h2 class="card-title">
                    <span class="card-icon">üìä</span>
                    Health Score
                </h2>
                <div class="score-circle" id="scoreCircle">
                    <span id="scoreValue">--</span>
                </div>
                <p class="score-text" id="scoreText">Complete the assessment to see your health score</p>
                
                <!-- Prediction Results -->
                <div class="prediction-results">
                    <div class="results-content">
                        <div class="no-results" id="noResults">
                            <div class="no-results-icon">‚ö°</div>
                            <span>Run prediction to see results</span>
                        </div>
                        <div class="results-display" id="resultsDisplay">
                            <!-- Results will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI-Based Suggestions Card -->
            <div class="card ai-suggestions">
                <h2 class="card-title">
                    <span class="card-icon">ü§ñ</span>
                    AI-Based Suggestions
                </h2>
                <div class="ai-suggestions-content">
                    <div class="ai-placeholder" id="aiPlaceholder">
                        <div class="ai-placeholder-icon">ü§ñ</div>
                        <div class="ai-placeholder-text">
                            <p>Get personalized AI-powered health insights and recommendations based on your assessment results.</p>
                            <p><strong>Complete the prediction first, then explore detailed AI suggestions!</strong></p>
                        </div>
                        <button class="explore-btn" id="exploreBtn" disabled>
                            <span class="loading-spinner" id="aiLoadingSpinner"></span>
                            <span id="exploreBtnText">üîç Explore AI Suggestions</span>
                        </button>
                    </div>
                    <div class="ai-results" id="aiResults">
                        <!-- AI suggestions will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Records Button -->
    <button class="data-records-btn" onclick="openDataModal()">
        üìä
    </button>

    <!-- Data Records Modal -->
    <div class="modal" id="dataModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üìä Sample Patient Data</h2>
                <button class="close-btn" onclick="closeDataModal()">√ó</button>
            </div>
            <div class="modal-body">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Age</th>
                            <th>Sex</th>
                            <th>EGFR</th>
                            <th>KRAS</th>
                            <th>ALK</th>
                            <th>TP53</th>
                            <th>STK11</th>
                            <th>KEAP1</th>
                            <th>BRAF</th>
                            <th>ROS1</th>
                            <th>MET</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody">
                        <!-- Data rows will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Success Message -->
    <div class="success-message" id="successMessage">
        ‚úÖ Data copied successfully!
    </div>

    <script>
        // Configuration
        const API_BASE_URL = 'https://precisionmedicine-production.up.railway.app';
        const GEMINI_API_KEY = 'AIzaSyDLyBdzczvr9AnanVbhDXt0AndaXkkOOnU';
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent';

        // Global variables for user management
        let currentUser = null;
        let currentUserEmail = null;
        let currentUserId = null;
        let currentPrediction = null;
        let currentInputData = null;
        let backendConnected = false;

        // Sample data for lung cancer prediction
        const sampleData = [
            {age: 65, sex: 1, egfr: 1, kras: 0, alk: 0, tp53: 1, stk11: 0, keap1: 0, braf: 0, ros1: 0, met: 0},
            {age: 72, sex: 0, egfr: 0, kras: 1, alk: 0, tp53: 0, stk11: 1, keap1: 0, braf: 0, ros1: 0, met: 0},
            {age: 58, sex: 1, egfr: 0, kras: 0, alk: 1, tp53: 0, stk11: 0, keap1: 0, braf: 0, ros1: 0, met: 0},
            {age: 67, sex: 0, egfr: 1, kras: 0, alk: 0, tp53: 1, stk11: 0, keap1: 1, braf: 0, ros1: 0, met: 0},
            {age: 74, sex: 1, egfr: 0, kras: 1, alk: 0, tp53: 1, stk11: 1, keap1: 0, braf: 0, ros1: 0, met: 0},
            {age: 63, sex: 0, egfr: 0, kras: 0, alk: 0, tp53: 0, stk11: 0, keap1: 0, braf: 1, ros1: 0, met: 0},
            {age: 69, sex: 1, egfr: 0, kras: 0, alk: 0, tp53: 0, stk11: 0, keap1: 0, braf: 0, ros1: 1, met: 0},
            {age: 55, sex: 0, egfr: 0, kras: 0, alk: 0, tp53: 0, stk11: 0, keap1: 0, braf: 0, ros1: 0, met: 1},
            {age: 71, sex: 1, egfr: 1, kras: 1, alk: 0, tp53: 1, stk11: 0, keap1: 0, braf: 0, ros1: 0, met: 0},
            {age: 60, sex: 0, egfr: 0, kras: 0, alk: 1, tp53: 0, stk11: 0, keap1: 1, braf: 0, ros1: 0, met: 0}
        ];

        // Generate a numeric user ID from email
        function generateUserId(email) {
            // Create a simple hash of the email to generate a consistent numeric ID
            let hash = 0;
            for (let i = 0; i < email.length; i++) {
                const char = email.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convert to 32bit integer
            }
            return String(Math.abs(hash % 9999) + 1001); // Return as string for PostgreSQL VARCHAR
        }

        // FIXED: Get current user information ONLY from dashboard localStorage (userAuth)
        function getCurrentUser() {
            console.log('üîç Retrieving current user information from dashboard...');
            
            try {
                // Get user authentication data from localStorage (from dashboard system)
                const userAuth = localStorage.getItem('userAuth');
                
                if (!userAuth) {
                    console.log('‚ö†Ô∏è No userAuth found in localStorage');
                    return null;
                }

                const userData = JSON.parse(userAuth);
                console.log('‚úÖ Found user authentication data from dashboard:', userData);
                
                // Extract REAL username and email from dashboard authentication
                const realUsername = userData.username || userData.displayName;
                const realEmail = userData.email;
                
                if (!realUsername || !realEmail) {
                    console.log('‚ö†Ô∏è Incomplete user data - missing username or email');
                    return null;
                }

                const userId = generateUserId(realEmail);
                
                console.log('üìã Extracted DASHBOARD user data:');
                console.log('  Username:', realUsername);
                console.log('  Email:', realEmail);
                console.log('  Generated User ID:', userId);
                
                return {
                    username: realUsername,
                    email: realEmail,
                    userId: userId,
                    uid: userData.uid || null
                };
                
            } catch (error) {
                console.error('‚ùå Error parsing userAuth data:', error);
                return null;
            }
        }

        // Update user interface with current user data from dashboard
        function updateUserInterface() {
            // Get current user information ONLY from dashboard
            const userInfo = getCurrentUser();
            
            if (!userInfo) {
                console.error('‚ùå No valid user data found from dashboard');
                currentUser = 'Unknown User';
                currentUserEmail = 'unknown@example.com';
                currentUserId = '1001';
            } else {
                currentUser = userInfo.username;
                currentUserEmail = userInfo.email;
                currentUserId = userInfo.userId;
            }
            
            console.log('üë§ Current user from DASHBOARD:', currentUser);
            console.log('üìß Current email from DASHBOARD:', currentUserEmail);
            console.log('üÜî Generated user ID:', currentUserId);
            
            // Update page title with user name
            document.title = `Lung Cancer Prediction - ${currentUser || 'User'} | Precision Medicine`;
            
            console.log('‚úÖ User interface updated with DASHBOARD data');
        }

        // Test backend connection
        async function testBackendConnection() {
            const connectionStatus = document.getElementById('connectionStatus');
            connectionStatus.style.display = 'block';
            connectionStatus.textContent = 'üîó Testing connection...';
            connectionStatus.className = 'connection-status';
            
            try {
                console.log('Testing backend connection...');
                const response = await fetch(`${API_BASE_URL}/health`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('‚úÖ Backend connected successfully:', data);
                    backendConnected = true;
                    connectionStatus.textContent = '‚úÖ Backend Connected';
                    connectionStatus.className = 'connection-status connected';
                    
                    // Hide after 3 seconds
                    setTimeout(() => {
                        connectionStatus.style.display = 'none';
                    }, 3000);
                    
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                console.error('‚ùå Backend connection failed:', error);
                backendConnected = false;
                connectionStatus.textContent = '‚ùå Backend Disconnected';
                connectionStatus.className = 'connection-status disconnected';
                
                showErrorMessage('‚ö†Ô∏è Cannot connect to backend server. Please check if the server is running.');
            }
        }

        // Validate numeric input values to prevent NaN
        function validateNumericInput(value, defaultValue = 0) {
            const num = parseFloat(value);
            if (isNaN(num) || !isFinite(num)) {
                return defaultValue;
            }
            return num;
        }

        // FIXED: Form submission - Store REAL dashboard username and email
        document.getElementById('predictionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const predictBtn = document.getElementById('predictBtn');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const btnText = document.getElementById('btnText');
            
            // Show loading state
            predictBtn.disabled = true;
            loadingSpinner.style.display = 'inline-block';
            btnText.textContent = 'Analyzing...';
            
            try {
                // Check backend connection first
                if (!backendConnected) {
                    await testBackendConnection();
                    if (!backendConnected) {
                        throw new Error('Backend server is not available. Please start the Flask server.');
                    }
                }

                // Collect form data with validation
                const formData = new FormData(this);
                const data = {};
                
                // Map form fields to expected format with validation
                data.age = validateNumericInput(formData.get('age'), 65);
                data.sex = validateNumericInput(formData.get('sex'), 0);
                data.egfr = document.getElementById('egfr').checked ? 1 : 0;
                data.kras = document.getElementById('kras').checked ? 1 : 0;
                data.alk = document.getElementById('alk').checked ? 1 : 0;
                data.tp53 = document.getElementById('tp53').checked ? 1 : 0;
                data.stk11 = document.getElementById('stk11').checked ? 1 : 0;
                data.keap1 = document.getElementById('keap1').checked ? 1 : 0;
                                data.braf = document.getElementById('braf').checked ? 1 : 0;
                data.ros1 = document.getElementById('ros1').checked ? 1 : 0;
                data.met = document.getElementById('met').checked ? 1 : 0;
                
                // FIXED: Add REAL user information from dashboard for PostgreSQL backend storage
                const dashboardUser = getCurrentUser();
                if (dashboardUser) {
                    data.user_id = String(dashboardUser.userId);  // Convert to string for PostgreSQL VARCHAR
                    data.username = dashboardUser.username;  // REAL username from dashboard
                    data.email = dashboardUser.email;        // REAL email from dashboard
                    
                    console.log('üìã Sending DASHBOARD user data to PostgreSQL backend:');
                    console.log('  Username:', dashboardUser.username);
                    console.log('  Email:', dashboardUser.email);
                    console.log('  User ID:', String(dashboardUser.userId), '(as string)');
                } else {
                    // Fallback - but this should not happen if user is logged in
                    data.user_id = String(currentUserId);  // Convert to string for PostgreSQL VARCHAR
                    data.username = currentUser;
                    data.email = currentUserEmail;
                    
                    console.log('‚ö†Ô∏è Using fallback user data for PostgreSQL');
                }
                
                // Store current input data with PostgreSQL-compatible fields
                currentInputData = {
                    ...data,
                    // Add default values for PostgreSQL lung_cancer_inputs table fields
                    yellow_fingers: 0,
                    anxiety: 0,
                    peer_pressure: 0,
                    chronic_disease: 0,
                    fatigue: 0,
                    allergy: 0,
                    wheezing: 0,
                    alcohol_consuming: 0,
                    coughing: 0,
                    shortness_of_breath: 0,
                    swallowing_difficulty: 0,
                    chest_pain: 0
                };
                
                console.log('üîç Sending lung cancer prediction request with DASHBOARD user data to PostgreSQL');
                
                // Make API call to backend with PostgreSQL-compatible data
                const backendData = {
                    ...data,
                    // Ensure user_id is string for PostgreSQL compatibility
                    user_id: String(data.user_id),
                    // Add required fields for PostgreSQL lung_cancer_inputs table
                    yellow_fingers: 0,
                    anxiety: 0,
                    peer_pressure: 0,
                    chronic_disease: 0,
                    fatigue: 0,
                    allergy: 0,
                    wheezing: 0,
                    alcohol_consuming: 0,
                    coughing: 0,
                    shortness_of_breath: 0,
                    swallowing_difficulty: 0,
                    chest_pain: 0
                };
                
                const response = await fetch(`${API_BASE_URL}/predict/lung-cancer`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(backendData)
                });
                
                console.log('üì° Response status:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('‚ùå Backend error response:', errorText);
                    
                    let errorMessage;
                    try {
                        const errorData = JSON.parse(errorText);
                        errorMessage = errorData.error || `HTTP error! status: ${response.status}`;
                    } catch (e) {
                        errorMessage = `HTTP error! status: ${response.status} - ${errorText}`;
                    }
                    
                    throw new Error(errorMessage);
                }
                
                const result = await response.json();
                console.log('‚úÖ Lung cancer prediction result from backend:', result);
                
                if (result.success) {
                    currentPrediction = result;
                    
                    updateHealthScore(result.health_score, result.risk_level);
                    updatePredictionResults(result, data);
                    
                    // Enable AI suggestions button
                    const exploreBtn = document.getElementById('exploreBtn');
                    exploreBtn.disabled = false;
                    exploreBtn.onclick = () => generateAISuggestions(currentInputData, currentPrediction);
                    
                    // Show success message with DASHBOARD username
                    showSuccessMessage(`‚úÖ Lung cancer prediction completed for ${dashboardUser ? dashboardUser.username : currentUser}!`);
                    
                    // Scroll to results
                    document.querySelector('.health-score').scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                    
                } else {
                    throw new Error(result.error || 'Prediction failed - no success flag');
                }
                
            } catch (error) {
                console.error('‚ùå Lung cancer prediction error:', error);
                showErrorMessage(`‚ùå Prediction Error: ${error.message}`);
                
                // If backend is down, offer to use mock data for demonstration
                if (error.message.includes('Backend server is not available') || 
                    error.message.includes('Failed to fetch')) {
                    
                    const useMock = confirm('Backend server is unavailable. Would you like to see a demo prediction? (Note: This will not be saved to the database)');
                    if (useMock) {
                        await handleMockPrediction(data);
                    }
                }
                
            } finally {
                // Reset loading state
                predictBtn.disabled = false;
                loadingSpinner.style.display = 'none';
                btnText.textContent = 'üîç Predict Lung Cancer Risk';
            }
        });

        // Fallback mock prediction for demonstration when backend is unavailable
        async function handleMockPrediction(data) {
            console.log('üîß Using mock lung cancer prediction for demonstration');
            
            // Simulate API delay
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            const mockResult = generateMockPrediction(data);
            
            if (mockResult.success) {
                currentPrediction = mockResult;
                
                updateHealthScore(mockResult.health_score, mockResult.risk_level);
                updatePredictionResults(mockResult, data);
                
                // Enable AI suggestions button
                const exploreBtn = document.getElementById('exploreBtn');
                exploreBtn.disabled = false;
                exploreBtn.onclick = () => generateAISuggestions(currentInputData, currentPrediction);
                
                showSuccessMessage('‚úÖ Demo lung cancer prediction completed!');
            }
        }

        // Generate mock prediction for demonstration when backend is down
        function generateMockPrediction(data) {
            // Calculate risk factors based on genetic mutations and age
            let riskScore = 0;
            
            // Age factor
            if (data.age > 70) riskScore += 25;
            else if (data.age > 60) riskScore += 15;
            else if (data.age > 50) riskScore += 10;
            
            // Gender factor (males historically higher risk)
            if (data.sex === 1) riskScore += 5;
            
            // High-risk genetic mutations
            if (data.egfr === 1) riskScore += 20;
            if (data.kras === 1) riskScore += 25;
            if (data.tp53 === 1) riskScore += 30;
            if (data.stk11 === 1) riskScore += 20;
            
            // Medium-risk genetic mutations
            if (data.alk === 1) riskScore += 15;
            if (data.keap1 === 1) riskScore += 15;
            if (data.braf === 1) riskScore += 10;
            if (data.ros1 === 1) riskScore += 10;
            if (data.met === 1) riskScore += 10;
            
            // Multiple mutations increase risk synergistically
            const mutationCount = [data.egfr, data.kras, data.alk, data.tp53, data.stk11, data.keap1, data.braf, data.ros1, data.met].filter(x => x === 1).length;
            if (mutationCount > 2) riskScore += 15;
            else if (mutationCount > 1) riskScore += 10;
            
            // Determine risk level and health score
            const healthScore = Math.max(10, Math.min(100, 100 - riskScore));
            const riskLevel = riskScore > 45 ? 'High Risk' : 'Low Risk';
            const confidence = Math.min(95, 75 + Math.random() * 20);
            
            return {
                success: true,
                health_score: Math.round(healthScore),
                risk_level: riskLevel,
                confidence: confidence,
                prediction_text: riskLevel === 'High Risk' ? 'High Risk of Lung Cancer' : 'Low Risk of Lung Cancer',
                probability: {
                    no_risk: 1 - (riskScore / 100),
                    high_risk: riskScore / 100
                },
                recommendations: generateRecommendations(data, riskLevel),
                interpretation: {
                    title: riskLevel === 'High Risk' ? 'High Risk Detected' : 'Low Risk Assessment',
                    description: riskLevel === 'High Risk' 
                        ? 'Your genetic profile indicates elevated lung cancer risk. Immediate medical consultation recommended.'
                        : 'Your assessment shows relatively low lung cancer risk. Continue preventive care and monitoring.'
                }
            };
        }

        // Update health score display
        function updateHealthScore(score, riskLevel) {
            const scoreCircle = document.getElementById('scoreCircle');
            const scoreValue = document.getElementById('scoreValue');
            const scoreText = document.getElementById('scoreText');
            
            // Validate score to prevent NaN display
            const validScore = validateNumericInput(score, 50);
            
            // Animate the score change
            let currentScore = 0;
            const targetScore = validScore;
            const increment = targetScore / 30; // 30 animation frames
            
            const animateScore = () => {
                currentScore += increment;
                if (currentScore >= targetScore) {
                    currentScore = targetScore;
                    scoreValue.textContent = Math.round(currentScore);
                } else {
                    scoreValue.textContent = Math.round(currentScore);
                    requestAnimationFrame(animateScore);
                }
            };
            
            requestAnimationFrame(animateScore);
            
            scoreText.textContent = `Health Score: ${riskLevel}`;
            
            // Update circle color based on score
            scoreCircle.className = 'score-circle';
            if (validScore >= 70) {
                scoreCircle.style.background = `conic-gradient(var(--success-green) 0deg, var(--success-green) ${validScore * 3.6}deg, rgba(16, 185, 129, 0.2) ${validScore * 3.6}deg)`;
            } else if (validScore >= 40) {
                scoreCircle.classList.add('warning');
                scoreCircle.style.background = `conic-gradient(var(--warning-orange) 0deg, var(--warning-orange) ${validScore * 3.6}deg, rgba(245, 158, 11, 0.2) ${validScore * 3.6}deg)`;
            } else {
                scoreCircle.classList.add('danger');
                scoreCircle.style.background = `conic-gradient(var(--danger-red) 0deg, var(--danger-red) ${validScore * 3.6}deg, rgba(239, 68, 68, 0.2) ${validScore * 3.6}deg)`;
            }
        }

        // Update prediction results display with NaN handling
        function updatePredictionResults(result, inputData) {
            const noResults = document.getElementById('noResults');
            const resultsDisplay = document.getElementById('resultsDisplay');
            
            noResults.style.display = 'none';
            resultsDisplay.style.display = 'block';
            
            // Use recommendations from backend if available, otherwise generate them
            const recommendations = result.recommendations || generateRecommendations(inputData, result.risk_level);
            
            // Handle NaN values in probabilities with proper validation
            const noRiskPercent = validateNumericInput((result.probability?.no_risk || 0) * 100, 50).toFixed(1);
            const highRiskPercent = validateNumericInput((result.probability?.high_risk || 0) * 100, 50).toFixed(1);
            const confidence = validateNumericInput(result.confidence, 75).toFixed(1);
            
            resultsDisplay.innerHTML = `
                <div class="result-summary">
                    <h3>${result.interpretation?.title || result.prediction_text}</h3>
                    <span class="risk-badge ${result.risk_level === 'High Risk' ? 'risk-high' : 'risk-low'}">
                        ${result.risk_level}
                    </span>
                </div>
                
                <div class="result-stats">
                    <div class="stat-item">
                        <span>Confidence:</span>
                        <strong>${confidence}%</strong>
                    </div>
                    <div class="stat-item">
                        <span>Low Risk:</span>
                        <strong>${noRiskPercent}%</strong>
                    </div>
                    <div class="stat-item">
                        <span>High Risk:</span>
                        <strong>${highRiskPercent}%</strong>
                    </div>
                </div>
                
                <div class="recommendations">
                    <h4>üéØ Personalized Recommendations</h4>
                    <div class="recommendation-list">
                        ${recommendations.map(rec => `
                            <div class="recommendation-item">
                                <span class="recommendation-icon">${typeof rec === 'string' ? 'üí°' : (rec.icon || 'üí°')}</span>
                                <span>${typeof rec === 'string' ? rec : rec.text}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // Generate recommendations based on genetic profile
        function generateRecommendations(data, riskLevel) {
            const recommendations = [];
            
            if (riskLevel === 'High Risk') {
                recommendations.push({
                    icon: 'üè•',
                    text: 'Schedule immediate consultation with an oncologist for comprehensive evaluation and screening'
                });
                
                recommendations.push({
                    icon: 'üî¨',
                    text: 'Discuss targeted therapy options based on your specific genetic mutations'
                });
            }
            
            // Specific recommendations based on genetic mutations
            if (data.egfr === 1) {
                recommendations.push({
                    icon: 'üß¨',
                    text: 'EGFR mutation detected - discuss EGFR inhibitor therapy options with your oncologist'
                });
            }
            
            if (data.kras === 1) {
                recommendations.push({
                    icon: 'üî¨',
                    text: 'KRAS mutation present - consider clinical trials for KRAS-targeted therapies'
                });
            }
            
            if (data.alk === 1) {
                recommendations.push({
                    icon: 'üíä',
                    text: 'ALK rearrangement detected - ALK inhibitor therapy may be highly effective'
                });
            }
            
            if (data.tp53 === 1) {
                recommendations.push({
                    icon: '‚ö†Ô∏è',
                    text: 'TP53 mutation requires careful monitoring - discuss enhanced screening protocols'
                });
            }
            
            if (data.stk11 === 1) {
                recommendations.push({
                    icon: 'üîç',
                    text: 'STK11 mutation detected - enhanced surveillance and immunotherapy considerations'
                });
            }
            
            if (data.keap1 === 1) {
                recommendations.push({
                    icon: 'üõ°Ô∏è',
                    text: 'KEAP1 mutation present - focus on oxidative stress management strategies'
                });
            }
            
            // General recommendations
            recommendations.push({
                icon: 'üö≠',
                text: 'Complete smoking cessation is critical - seek professional support programs'
            });
            
            recommendations.push({
                icon: 'üåø',
                text: 'Maintain lung-healthy diet rich in antioxidants and anti-inflammatory foods'
            });
            
            recommendations.push({
                icon: 'üèÉ',
                text: 'Regular exercise improves lung function and overall health outcomes'
            });
            
            if (riskLevel === 'Low Risk') {
                recommendations.push({
                    icon: '‚úÖ',
                    text: 'Continue preventive care - schedule regular screening as recommended'
                });
            }
            
            return recommendations.slice(0, 6); // Limit to 6 recommendations
        }

        // Generate AI suggestions using Google Gemini API
        async function generateAISuggestions(inputData, predictionResult) {
            const exploreBtn = document.getElementById('exploreBtn');
            const aiLoadingSpinner = document.getElementById('aiLoadingSpinner');
            const exploreBtnText = document.getElementById('exploreBtnText');
            
            // Show loading state
            exploreBtn.disabled = true;
            aiLoadingSpinner.style.display = 'inline-block';
            exploreBtnText.textContent = 'Generating AI Insights...';
            
            try {
                // Get dashboard user data for personalized AI response
                const dashboardUser = getCurrentUser();
                const userName = dashboardUser ? dashboardUser.username : currentUser;
                
                // Prepare patient data for AI analysis
                const patientProfile = {
                    name: userName,
                    age: inputData.age,
                    sex: inputData.sex === 1 ? 'Male' : 'Female',
                    egfr: inputData.egfr === 1 ? 'Yes' : 'No',
                    kras: inputData.kras === 1 ? 'Yes' : 'No',
                    alk: inputData.alk === 1 ? 'Yes' : 'No',
                    tp53: inputData.tp53 === 1 ? 'Yes' : 'No',
                    stk11: inputData.stk11 === 1 ? 'Yes' : 'No',
                    keap1: inputData.keap1 === 1 ? 'Yes' : 'No',
                    braf: inputData.braf === 1 ? 'Yes' : 'No',
                    ros1: inputData.ros1 === 1 ? 'Yes' : 'No',
                    met: inputData.met === 1 ? 'Yes' : 'No',
                    health_score: predictionResult.health_score,
                    risk_level: predictionResult.risk_level
                };

                const prompt = `You are a senior oncologist AI assistant specializing in lung cancer. Based on the following patient data and lung cancer risk assessment, provide detailed medical insights and recommendations in exactly the format specified below.

Patient Profile for ${userName}:
- Age: ${patientProfile.age} years
- Sex: ${patientProfile.sex}
- EGFR Mutation: ${patientProfile.egfr}
- KRAS Mutation: ${patientProfile.kras}
- ALK Mutation: ${patientProfile.alk}
- TP53 Mutation: ${patientProfile.tp53}
- STK11 Mutation: ${patientProfile.stk11}
- KEAP1 Mutation: ${patientProfile.keap1}
- BRAF Mutation: ${patientProfile.braf}
- ROS1 Mutation: ${patientProfile.ros1}
- MET Mutation: ${patientProfile.met}

Assessment Results for ${userName}:
- Health Score: ${patientProfile.health_score}/100
- Risk Level: ${patientProfile.risk_level}

Please provide responses in exactly this format:

CONDITION_DESCRIPTION:
[Provide a detailed 5-6 line medical explanation of ${userName}'s current lung cancer risk based on the genetic profile and data, including analysis of key mutations, current health status, and medical significance of the findings]

LIFESTYLE_RECOMMENDATIONS:
[Provide 5-6 specific lifestyle changes and daily habits recommendations for ${userName}'s condition, including smoking cessation, environmental factors, activity levels, and general wellness practices]

MEDICAL_RECOMMENDATIONS:
[Provide 5-6 medical care and monitoring suggestions for ${userName}, including specific tests, follow-up schedules, specialist consultations, and medical management strategies for lung cancer risk]

DIETARY_SUGGESTIONS:
[Provide 5-6 specific dietary recommendations for lung health based on ${userName}'s condition, including antioxidant-rich foods, foods to avoid, and nutritional support]

EXERCISE_RECOMMENDATIONS:
[Provide 5-6 exercise and physical activity suggestions appropriate for ${userName}'s age, condition, and risk level, including types, duration, intensity, and lung health benefits]

MONITORING_SUGGESTIONS:
[Provide 5-6 health monitoring and follow-up recommendations for ${userName}, including what to track, frequency of monitoring, warning signs to watch for, and when to seek immediate care]

Keep each section detailed but concise. Focus on actionable, specific advice tailored to ${userName}'s unique genetic profile and lung cancer risk.`;

                const requestBody = {
                    contents: [{
                        parts: [{
                            text: prompt
                        }]
                    }],
                    generationConfig: {
                        temperature: 0.7,
                        topK: 40,
                        topP: 0.8,
                        maxOutputTokens: 1024,
                    },
                    safetySettings: [
                        {
                            category: "HARM_CATEGORY_HARASSMENT",
                            threshold: "BLOCK_MEDIUM_AND_ABOVE"
                        },
                        {
                            category: "HARM_CATEGORY_HATE_SPEECH",
                            threshold: "BLOCK_MEDIUM_AND_ABOVE"
                        },
                        {
                            category: "HARM_CATEGORY_SEXUALLY_EXPLICIT",
                            threshold: "BLOCK_MEDIUM_AND_ABOVE"
                        },
                        {
                            category: "HARM_CATEGORY_DANGEROUS_CONTENT",
                            threshold: "BLOCK_MEDIUM_AND_ABOVE"
                        }
                    ]
                };

                console.log(`ü§ñ Making AI request to Gemini API for ${userName}...`);

                // Make API call to Google Gemini
                const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('AI API Error Response:', errorText);
                    throw new Error(`AI API request failed: ${response.status} - ${response.statusText}`);
                }

                const data = await response.json();
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts[0]) {
                    const aiResponse = data.candidates[0].content.parts[0].text;
                    console.log('‚úÖ AI Response received for lung cancer analysis');
                    displayAISuggestions(aiResponse);
                } else {
                    console.error('Invalid AI API response structure:', data);
                    throw new Error('Invalid AI response format');
                }
                
            } catch (error) {
                console.error('ü§ñ AI Suggestions Error:', error);
                showErrorMessage(`‚ö†Ô∏è AI Service Error: ${error.message}`);
                
                // Fallback to basic AI suggestions
                displayFallbackAISuggestions(inputData, predictionResult);
            } finally {
                // Reset button state
                exploreBtn.disabled = false;
                aiLoadingSpinner.style.display = 'none';
                exploreBtnText.textContent = 'üîç Explore AI Suggestions';
            }
        }

        // Display AI suggestions in the UI
        function displayAISuggestions(aiResponse) {
            const aiPlaceholder = document.getElementById('aiPlaceholder');
            const aiResults = document.getElementById('aiResults');
            
            aiPlaceholder.style.display = 'none';
            aiResults.style.display = 'block';
            
            // Parse AI response
            const sections = parseAIResponse(aiResponse);
            
            aiResults.innerHTML = `
                <div class="condition-description">
                    <h4>üîç AI Lung Cancer Analysis for ${currentUser}</h4>
                    <p>${sections.condition || 'Based on your genetic profile and assessment, our AI analysis provides personalized insights into your lung cancer risk factors and health status.'}</p>
                </div>
                
                <div class="ai-suggestions-list">
                    <div class="ai-suggestion-item">
                        <div class="ai-suggestion-icon">üèÉ</div>
                        <div class="ai-suggestion-content">
                            <h5>Lifestyle Recommendations</h5>
                            <p>${sections.lifestyle || 'Maintain a smoke-free environment, avoid secondhand smoke, limit exposure to radon and asbestos, exercise regularly, manage stress, and maintain a healthy weight through balanced nutrition.'}</p>
                        </div>
                    </div>
                    
                    <div class="ai-suggestion-item">
                        <div class="ai-suggestion-icon">üè•</div>
                        <div class="ai-suggestion-content">
                            <h5>Medical Care Recommendations</h5>
                            <p>${sections.medical || 'Schedule regular screenings with your oncologist, consider low-dose CT scans for early detection, discuss genetic counseling, follow medication schedules, and maintain updated medical records.'}</p>
                        </div>
                    </div>
                    
                    <div class="ai-suggestion-item">
                        <div class="ai-suggestion-icon">ü•ó</div>
                        <div class="ai-suggestion-content">
                            <h5>Dietary Suggestions</h5>
                            <p>${sections.dietary || 'Consume antioxidant-rich foods like berries, leafy greens, and cruciferous vegetables. Include omega-3 fatty acids, limit processed meats, avoid excessive alcohol, and maintain proper hydration.'}</p>
                        </div>
                    </div>
                    
                    <div class="ai-suggestion-item">
                        <div class="ai-suggestion-icon">üí™</div>
                        <div class="ai-suggestion-content">
                            <h5>Exercise Recommendations</h5>
                            <p>${sections.exercise || 'Engage in regular aerobic exercise to improve lung function, include breathing exercises, practice yoga or tai chi, start gradually if sedentary, and always consult your doctor before starting new programs.'}</p>
                        </div>
                    </div>
                    
                    <div class="ai-suggestion-item">
                        <div class="ai-suggestion-icon">üìä</div>
                        <div class="ai-suggestion-content">
                            <h5>Health Monitoring</h5>
                            <p>${sections.monitoring || 'Monitor respiratory symptoms, track any changes in cough or breathing, schedule regular imaging studies, maintain communication with your healthcare team, and use monitoring devices as recommended.'}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Parse AI response into structured sections
        function parseAIResponse(response) {
            const sections = {
                condition: '',
                lifestyle: '',
                medical: '',
                dietary: '',
                exercise: '',
                monitoring: ''
            };
            
            try {
                // Split response by section headers
                const conditionMatch = response.match(/CONDITION_DESCRIPTION:\s*([\s\S]*?)(?=LIFESTYLE_RECOMMENDATIONS:|$)/i);
                const lifestyleMatch = response.match(/LIFESTYLE_RECOMMENDATIONS:\s*([\s\S]*?)(?=MEDICAL_RECOMMENDATIONS:|$)/i);
                const medicalMatch = response.match(/MEDICAL_RECOMMENDATIONS:\s*([\s\S]*?)(?=DIETARY_SUGGESTIONS:|$)/i);
                const dietaryMatch = response.match(/DIETARY_SUGGESTIONS:\s*([\s\S]*?)(?=EXERCISE_RECOMMENDATIONS:|$)/i);
                const exerciseMatch = response.match(/EXERCISE_RECOMMENDATIONS:\s*([\s\S]*?)(?=MONITORING_SUGGESTIONS:|$)/i);
                const monitoringMatch = response.match(/MONITORING_SUGGESTIONS:\s*([\s\S]*?)$/i);
                
                if (conditionMatch) sections.condition = conditionMatch[1].trim();
                if (lifestyleMatch) sections.lifestyle = lifestyleMatch[1].trim();
                if (medicalMatch) sections.medical = medicalMatch[1].trim();
                if (dietaryMatch) sections.dietary = dietaryMatch[1].trim();
                if (exerciseMatch) sections.exercise = exerciseMatch[1].trim();
                if (monitoringMatch) sections.monitoring = monitoringMatch[1].trim();
                
            } catch (error) {
                console.error('Error parsing AI response:', error);
            }
            
            return sections;
        }

        // Fallback AI suggestions when API fails
        function displayFallbackAISuggestions(inputData, predictionResult) {
            const aiPlaceholder = document.getElementById('aiPlaceholder');
            const aiResults = document.getElementById('aiResults');
            
            aiPlaceholder.style.display = 'none';
            aiResults.style.display = 'block';
            
            const riskLevel = predictionResult.risk_level;
            const age = inputData.age;
            const mutationCount = [inputData.egfr, inputData.kras, inputData.alk, inputData.tp53, inputData.stk11, inputData.keap1, inputData.braf, inputData.ros1, inputData.met].filter(x => x === 1).length;
            const userName = getCurrentUser()?.username || currentUser;
            
            aiResults.innerHTML = `
                <div class="condition-description">
                    <h4>üîç AI Lung Cancer Analysis for ${userName}</h4>
                    <p>Your lung cancer risk assessment shows ${riskLevel.toLowerCase()} based on genetic mutations and risk factors. ${mutationCount > 0 ? `${mutationCount} genetic mutations detected require specialized monitoring.` : 'No significant genetic mutations detected.'} Regular screening and preventive care are essential for maintaining optimal lung health.</p>
                </div>
                
                <div class="ai-suggestions-list">
                    <div class="ai-suggestion-item">
                        <div class="ai-suggestion-icon">üèÉ</div>
                        <div class="ai-suggestion-content">
                            <h5>Lifestyle Recommendations</h5>
                            <p>${age > 65 ? 'Focus on gentle, lung-healthy activities and avoid environmental toxins. ' : 'Maintain active lifestyle with regular cardiopulmonary exercise. '}Ensure smoke-free environment and avoid secondhand smoke exposure. ${mutationCount > 2 ? 'Enhanced environmental protection is crucial due to genetic predisposition.' : 'Continue healthy lifestyle practices.'}</p>
                        </div>
                    </div>
                    
                    <div class="ai-suggestion-item">
                        <div class="ai-suggestion-icon">üè•</div>
                        <div class="ai-suggestion-content">
                            <h5>Medical Care Recommendations</h5>
                            <p>${riskLevel === 'High Risk' ? 'Schedule immediate oncology consultation and consider low-dose CT screening. ' : 'Maintain regular lung health check-ups and screening protocols. '}${mutationCount > 0 ? 'Genetic counseling recommended for personalized treatment planning. ' : 'Continue standard preventive care. '}Monitor respiratory symptoms closely and report changes promptly.</p>
                        </div>
                    </div>
                    
                    <div class="ai-suggestion-item">
                        <div class="ai-suggestion-icon">ü•ó</div>
                        <div class="ai-suggestion-content">
                            <h5>Dietary Suggestions</h5>
                            <p>Emphasize antioxidant-rich foods including berries, leafy greens, and cruciferous vegetables. Include omega-3 fatty acids from fish and nuts. ${mutationCount > 1 ? 'Enhanced anti-inflammatory diet recommended due to genetic factors. ' : 'Maintain balanced, nutrient-dense diet. '}Limit processed foods and maintain proper hydration for optimal lung function.</p>
                        </div>
                    </div>
                    
                    <div class="ai-suggestion-item">
                        <div class="ai-suggestion-icon">üí™</div>
                        <div class="ai-suggestion-content">
                            <h5>Exercise Recommendations</h5>
                            <p>${age > 65 ? 'Engage in gentle aerobic activities like walking, swimming, or cycling for 30 minutes daily. ' : 'Aim for 150 minutes of moderate aerobic activity weekly including cardio exercises. '}Include breathing exercises and pulmonary rehabilitation techniques. Start gradually and build endurance progressively under medical guidance.</p>
                        </div>
                    </div>
                    
                    <div class="ai-suggestion-item">
                        <div class="ai-suggestion-icon">üìä</div>
                        <div class="ai-suggestion-content">
                            <h5>Health Monitoring</h5>
                            <p>${riskLevel === 'High Risk' ? 'Schedule frequent imaging studies and biomarker monitoring. ' : 'Annual lung health screening and regular check-ups. '}Track respiratory symptoms, persistent cough, or breathing changes. ${mutationCount > 2 ? 'Enhanced genetic monitoring and family screening recommended. ' : 'Standard monitoring protocols sufficient. '}Maintain open communication with healthcare team.</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Clear Results Function
        function clearResults() {
            // Reset health score
            const scoreCircle = document.getElementById('scoreCircle');
            const scoreValue = document.getElementById('scoreValue');
            const scoreText = document.getElementById('scoreText');
            
            scoreValue.textContent = '--';
            scoreText.textContent = 'Complete the assessment to see your health score';
            scoreCircle.className = 'score-circle';
            scoreCircle.style.background = 'conic-gradient(var(--success-green) 0deg, var(--success-green) 252deg, rgba(16, 185, 129, 0.2) 252deg)';
            
            // Reset prediction results
            const noResults = document.getElementById('noResults');
            const resultsDisplay = document.getElementById('resultsDisplay');
            
            noResults.style.display = 'flex';
            resultsDisplay.style.display = 'none';
            
            // Reset AI suggestions
            const aiPlaceholder = document.getElementById('aiPlaceholder');
            const aiResults = document.getElementById('aiResults');
            const exploreBtn = document.getElementById('exploreBtn');
            
            aiPlaceholder.style.display = 'flex';
            aiResults.style.display = 'none';
            exploreBtn.disabled = true;
            
            // Reset global variables
            currentPrediction = null;
            currentInputData = null;
            
            // Show success message
            showSuccessMessage('‚ú® Results cleared successfully!');
        }

        // Show success message
        function showSuccessMessage(message = '‚úÖ Success!') {
            const successMessage = document.getElementById('successMessage');
            successMessage.textContent = message;
            successMessage.style.background = 'var(--success-green)';
            successMessage.classList.add('show');
            
            setTimeout(() => {
                successMessage.classList.remove('show');
            }, 3000);
        }

        // Show error message
        function showErrorMessage(message) {
            const successMessage = document.getElementById('successMessage');
            successMessage.textContent = message;
            successMessage.style.background = 'var(--danger-red)';
            successMessage.classList.add('show');
            
            setTimeout(() => {
                successMessage.classList.remove('show');
                successMessage.style.background = 'var(--success-green)';
            }, 5000);
        }

        // Modal Functions
        function openDataModal() {
            populateDataTable();
            document.getElementById('dataModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeDataModal() {
            document.getElementById('dataModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('dataModal');
            if (event.target === modal) {
                closeDataModal();
            }
        }

        // ESC key to close modal
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeDataModal();
            }
        });

        // Populate data table
        function populateDataTable() {
            const tableBody = document.getElementById('dataTableBody');
            tableBody.innerHTML = '';

            sampleData.forEach((record, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${record.age}</td>
                    <td>${record.sex === 1 ? 'Male' : 'Female'}</td>
                    <td>${record.egfr === 1 ? 'Yes' : 'No'}</td>
                    <td>${record.kras === 1 ? 'Yes' : 'No'}</td>
                    <td>${record.alk === 1 ? 'Yes' : 'No'}</td>
                    <td>${record.tp53 === 1 ? 'Yes' : 'No'}</td>
                    <td>${record.stk11 === 1 ? 'Yes' : 'No'}</td>
                    <td>${record.keap1 === 1 ? 'Yes' : 'No'}</td>
                    <td>${record.braf === 1 ? 'Yes' : 'No'}</td>
                    <td>${record.ros1 === 1 ? 'Yes' : 'No'}</td>
                    <td>${record.met === 1 ? 'Yes' : 'No'}</td>
                    <td><button class="copy-btn" onclick="copyData(${index})">üìã Copy</button></td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Copy data to form
        function copyData(index) {
            const record = sampleData[index];
            
            // Fill form fields
            document.getElementById('age').value = record.age;
            document.getElementById('sex').value = record.sex;
            document.getElementById('egfr').checked = record.egfr === 1;
            document.getElementById('kras').checked = record.kras === 1;
            document.getElementById('alk').checked = record.alk === 1;
            document.getElementById('tp53').checked = record.tp53 === 1;
            document.getElementById('stk11').checked = record.stk11 === 1;
            document.getElementById('keap1').checked = record.keap1 === 1;
            document.getElementById('braf').checked = record.braf === 1;
            document.getElementById('ros1').checked = record.ros1 === 1;
            document.getElementById('met').checked = record.met === 1;
            
            // Show success message
            showSuccessMessage('‚úÖ Data copied successfully!');
            
            // Close modal
            closeDataModal();
            
            // Scroll to top of form
            document.querySelector('.patient-info').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // FIXED: Get current user information ONLY from dashboard/login system
            updateUserInterface();
            
            // Test backend connection on page load
            testBackendConnection();
            
            // Add animation to data records button
            const dataBtn = document.querySelector('.data-records-btn');
            setTimeout(() => {
                dataBtn.style.animation = 'pulse 2s infinite';
            }, 2000);
            
            console.log('üöÄ Lung Cancer Prediction Page loaded successfully');
            console.log('üë§ Current user from DASHBOARD:', currentUser);
            console.log('üìß Current email from DASHBOARD:', currentUserEmail);
            console.log('üÜî Generated user ID:', currentUserId);
            console.log('üîó Backend URL:', API_BASE_URL);
            console.log('ü§ñ AI API configured:', GEMINI_API_KEY ? 'Yes' : 'No');
        });

        // Add pulse animation for the data records button
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.05); }
                100% { transform: scale(1); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>